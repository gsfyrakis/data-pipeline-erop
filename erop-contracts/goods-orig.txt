roleplayer supplier,purchaser;
businessoperation POSubmission,GoodsDelivery,Payment,SpecialPOSubmission,ReplacementClaim,InterestPayment,GoodsDeliveryTimeout;
rule "R1NormalOrder"  when
    e matches (botype == POSubmission,originator == purchaser,outcome == success)
    POSubmission in purchaser.rights
then
    supplier.obligs += GoodsDelivery("24hour")
    purchaser.obligs += Payment("7day")
end

rule "R1SpecialOrder"  when
    e matches (botype == SpecialPOSubmission,originator == purchaser,outcome == success)
    SpecialPOSubmission in purchaser.rights
then
    supplier.obligs += GoodsDelivery("24hour")
    purchaser.obligs += Payment("7day")
end

rule "R2"  when
    e matches (botype == Payment,originator == purchaser,outcome == success)
    Payment in purchaser.obligs
then
purchaser.obligs -= Payment
purchaser.obligs += InterestPayment("1minute")
end

rule "R3" when
    e matches (botype == GoodsDelivery,originator == supplier)
    GoodsDelivery in supplier.obligs
then
supplier.obligs -= GoodsDelivery
purchaser.rights += ReplacementClaim
if (happened(GoodsDeliveryTimeout,supplier,purchaser,"historical query",Success) )
supplier.obligs += HourlyPenalty("1hour")
endif
end

rule "R4"  when
    e matches (botype == ReplacementClaim,originator == purchaser,outcome == success)
    ReplacementClaim in purchaser.rights
then
    supplier.obligs += GoodsDelivery("3day")
end

rule "R5"  when
    e matches (botype == GoodsDeliveryTimeout,originator == supplier,outcome == success)
    GoodsDelivery in supplier.obligs
    happened(ReplacementClaim,purchaser,supplier,"Replacement claim", Success)
then
    supplier.obligs -= GoodsDelivery
end